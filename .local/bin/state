#!/usr/bin/env bash

set -o pipefail

# state dirs
general=(.mozilla/firefox/profile .vim/{undo,swap} .config/transmission-daemon .local/share/zathura .config/mpv/watch_later)
# state files
general+=(.viminfo .config/fish/fish_variables .local/share/fish/fish_history "$(readlink .wallpaper)")
# secret dirs
general+=(.password-store)
# secret files
general+=(.ssh/hosts)
# machine specific dirs
machine=(.config/syncthing .stfolder)
# machine specific files
machine+=(.config/pulse/default.pa)

: ${host:="$(hostname)"}
: ${remote:="${host}_phone"}
remote_general="$remote:general/./"
remote_machine="$remote:$host/./"

rsync_flags=(-aR --delete -i)

cd

case "$1" in
push)
	rsync "${rsync_flags[@]}" "${general[@]}" "$remote_general"
	rsync "${rsync_flags[@]}" "${machine[@]}" "$remote_machine"
;;
pull)
	rsync "${rsync_flags[@]}" "${general[@]/#/"$remote_general"}" ~
	rsync "${rsync_flags[@]}" "${machine[@]/#/"$remote_machine"}" ~
;;
esac
